---
import type { GetStaticPaths } from 'astro'
import Layout from '@/layouts/default.astro'
import Sidebar from '@/components/sidebar.astro'
import { getCollection, getEntry } from 'astro:content'

export const getStaticPaths = (async () => {
	const docs = await getCollection('docs')

	return docs.map((page) => {
		return {
			params: {
				slug: page.slug,
			},
			props: {
				page,
			},
		}
	})
}) satisfies GetStaticPaths

const sidebar = await getEntry('sidebar', 'main')

const { page } = Astro.props
const { Content, headings } = await page.render()

const pagefindProps = page.data.pagefind?.ignore
	? { 'data-pagefind-ignore': true }
	: { 'data-pagefind-body': true }
---

<Layout title={`${page.data.title} - Souls Speedruns`}>
	<main class="container mx-auto mt-16 grid grid-cols-10">
		<aside
			class="fixed top-16 col-span-2 hidden h-[calc(100vh-theme('spacing.16'))] w-full border-r py-2 pr-2 md:sticky md:block"
		>
			<Sidebar sidebar={sidebar} />
		</aside>
		<div
			class="prose col-span-10 max-w-none px-4 py-2 dark:prose-invert md:col-span-6"
			{...pagefindProps}
		>
			<h1 data-pagefind-weight="10">{page.data.title}</h1>
			<Content />
		</div>
		<aside
			class="col-span-2 hidden min-h-[calc(100vh-theme('spacing.16'))] border-l px-4 py-2 md:block"
		>
			<div class="sticky top-[calc(theme('spacing.16')+theme('spacing.2'))]">
				{
					headings.filter((heading) => heading.depth > 1).length > 0 && (
						<>
							<h4 class="font-bold">On This Page</h4>
							<ul class="mb-3 border-b pb-3">
								{headings.map((heading) => (
									<li>
										<a href={`#${heading.slug}`}>{heading.text}</a>
									</li>
								))}
							</ul>
						</>
					)
				}
				<a
					href={`/keystatic/collection/${
						page.collection
					}/item/${encodeURIComponent(page.slug)}`}
					target="_blank"
					>Edit this page</a
				>
			</div>
		</aside>
	</main>
</Layout>
